name: ğŸ” Lint Code

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  lint-frontend:
    name: ğŸ”§ Lint Frontend (TypeScript/JavaScript)
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"
          cache-dependency-path: "browser-extension/package-lock.json"

      - name: ğŸ“š Install dependencies
        working-directory: browser-extension
        run: npm ci

      - name: ğŸ” Run ESLint
        working-directory: browser-extension
        run: npm run lint

  lint-backend:
    name: ğŸ Lint Backend (Python)
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"
          cache: "pip"

      - name: ğŸ“š Install Python linting tools
        run: |
          python -m pip install --upgrade pip
          pip install flake8 black isort

      - name: ğŸ” Run flake8 (Style Guide Enforcement)
        run: |
          flake8 backend --count --select=E9,F63,F7,F82 --show-source --statistics
          flake8 backend --count --exit-zero --max-complexity=10 --max-line-length=88 --statistics

      - name: ğŸ¨ Check code formatting with black
        run: black --check --diff backend

      - name: ğŸ“¦ Check import sorting with isort
        run: isort --check-only --diff backend

  lint-configs:
    name: ğŸ“ Lint Configuration Files
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js (for markdownlint)
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: ğŸ Setup Python (for yamllint)
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: ğŸ“š Install linting tools
        run: |
          # YAML linting
          pip install yamllint
          # Markdown linting
          npm install -g markdownlint-cli
          # Dockerfile linting
          wget -O hadolint https://github.com/hadolint/hadolint/releases/download/v2.12.0/hadolint-Linux-x86_64
          chmod +x hadolint
          sudo mv hadolint /usr/local/bin/

      - name: ğŸ”§ Lint YAML files
        run: yamllint -c .yamllint.yml .

      - name: ğŸ“‹ Lint Markdown files
        run: markdownlint "**/*.md" --config .markdownlint.json --ignore node_modules

      - name: ğŸ³ Lint Dockerfiles
        run: |
          find . -name "Dockerfile*" -not -path "./node_modules/*" -not -path "./.git/*" | xargs hadolint
